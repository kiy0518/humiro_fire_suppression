# QGC 비디오 수신 옵션 지연 시간 분석

## 지연 시간 비교 (낮은 순서)

### 1. **UDP h.264 비디오 스트림** ⭐ (가장 낮은 지연 - 권장)
- **지연**: ~50-100ms (가장 낮음)
- **프로토콜**: UDP (User Datagram Protocol)
- **코덱**: H.264/AVC
- **특징**:
  - UDP는 연결 없이 전송 (3-way handshake 없음)
  - 재전송 없음 (지연 최소화)
  - VIM4 하드웨어 인코더(`amlvenc`) 사용 가능
  - QGC에서 가장 널리 사용되는 방식
- **권장 사용**: 실시간 드론 제어, FPV 비행

### 2. **UDP h.265 비디오 스트림** ⭐ (매우 낮은 지연)
- **지연**: ~50-120ms (H.264와 비슷)
- **프로토콜**: UDP
- **코덱**: H.265/HEVC
- **특징**:
  - H.264보다 더 나은 압축 효율 (같은 품질에서 더 작은 파일 크기)
  - UDP 기반이므로 지연은 H.264와 비슷
  - VIM4 하드웨어 인코더 지원
- **권장 사용**: 고해상도 스트리밍, 대역폭 제한 환경

### 3. **RTSP 비디오 스트림** ⚠️ (중간 지연)
- **지연**: ~200-500ms
- **프로토콜**: RTSP (Real-Time Streaming Protocol) - TCP 기반
- **코덱**: 일반적으로 H.264
- **특징**:
  - TCP 연결 기반 (3-way handshake 필요)
  - 재전송으로 인한 지연 가능
  - 표준 스트리밍 프로토콜
- **권장 사용**: 녹화, 분석용 (실시간 제어에는 부적합)

### 4. **TCP-MPEG2 비디오 스트림** ⚠️ (높은 지연)
- **지연**: ~300-800ms
- **프로토콜**: TCP
- **코덱**: MPEG-2
- **특징**:
  - TCP 기반 (재전송으로 인한 지연)
  - 오래된 코덱 (압축 효율 낮음)
- **권장 사용**: 레거시 시스템 호환

### 5. **MPEG-TS Video Stream** ⚠️ (높은 지연)
- **지연**: ~300-800ms
- **프로토콜**: 일반적으로 TCP
- **코덱**: MPEG Transport Stream
- **특징**:
  - 방송용 컨테이너 포맷
  - TCP 기반이면 지연 높음
- **권장 사용**: 방송, 녹화용

## 결론

**가장 낮은 지연**: **UDP h.264 비디오 스트림** 또는 **UDP h.265 비디오 스트림**

### 권장 설정

1. **실시간 드론 제어 (FPV)**: UDP h.264
   - 가장 낮은 지연
   - 널리 지원됨
   - VIM4 하드웨어 인코더 사용

2. **고해상도 스트리밍**: UDP h.265
   - 비슷한 지연
   - 더 나은 압축 효율
   - 대역폭 절약

3. **녹화/분석용**: RTSP
   - 안정적인 연결
   - 표준 프로토콜

## 현재 코드 설정

`RGB_Camera_Stream.py`는 기본적으로 **UDP h.264**를 사용합니다 (가장 낮은 지연).

압축 방식 변경:
```bash
# H.264 (기본값, 가장 낮은 지연)
export QGC_CODEC=h264
python3 RGB_Camera_Stream.py

# H.265 (더 나은 압축, 비슷한 지연)
export QGC_CODEC=h265
python3 RGB_Camera_Stream.py

# MJPEG (소프트웨어 인코딩, 약간 높은 지연)
export QGC_CODEC=mjpeg
python3 RGB_Camera_Stream.py
```

## QGC 설정 방법

1. QGC > Settings > General > Video
2. **Video Source**: "UDP h.264 비디오 스트림" 선택 (또는 "UDP h.265 비디오 스트림")
3. **UDP Port**: `5600` (기본값)
4. **UDP Address**: 비워두거나 `0.0.0.0` (브로드캐스트 수신)

## 지연 시간 최적화 팁

1. **해상도 낮추기**: 1280x720 권장 (1920x1080보다 지연 낮음)
2. **FPS 조정**: 30 FPS 권장 (60 FPS는 더 높은 지연)
3. **하드웨어 인코더 사용**: VIM4의 `amlvenc` 사용 (소프트웨어보다 빠름)
4. **큐 크기 최소화**: 버퍼링 최소화 (현재 코드: maxsize=2)
5. **네트워크 최적화**: 유선 연결 권장, WiFi는 지연 증가 가능
