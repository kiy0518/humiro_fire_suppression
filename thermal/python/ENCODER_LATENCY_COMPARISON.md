# 인코더 지연 시간 비교

## 지연 시간 순위 (낮은 순서)

### 1. 하드웨어 H.264 (amlvenc) ⭐ (가장 낮음 - 권장)
- **지연**: ~50-100ms
- **인코더**: VIM4 하드웨어 인코더 (`amlvenc`)
- **특징**: 
  - 가장 낮은 지연
  - CPU 부하 낮음
  - 전력 효율적
- **문제**: 현재 초기화는 성공하지만 프레임 쓰기 실패 중

### 2. 소프트웨어 H.264 (openh264enc) ⭐ (허용 가능)
- **지연**: ~100-200ms
- **인코더**: OpenH264 소프트웨어 인코더
- **특징**:
  - 하드웨어 인코더 실패 시 자동 폴백
  - 지연이 약간 높지만 실시간 사용 가능
  - CPU 부하 높음
- **최적화**: `speed-preset=ultrafast` 사용으로 지연 감소

### 3. MJPEG (jpegenc) ⚠️ (지연 높음)
- **지연**: ~150-300ms
- **인코더**: JPEG 소프트웨어 인코더
- **특징**:
  - 가장 안정적 (인코더 문제 없음)
  - H.264보다 지연이 높지만 실시간 사용 가능
  - CPU 부하 높음
  - 대역폭 사용량 높음 (압축 효율 낮음)
- **최적화**: quality 낮추기 (85 → 75)로 지연 감소

## 현재 상황

하드웨어 H.264 인코더가 작동하지 않으므로:
1. **소프트웨어 H.264 인코더로 자동 폴백** (권장)
   - 지연: ~100-200ms (하드웨어보다 약간 높지만 허용 가능)
   - 코드가 자동으로 시도합니다

2. **MJPEG 사용** (안정성 우선)
   - 지연: ~150-300ms (H.264보다 높지만 여전히 실시간 사용 가능)
   - 가장 안정적

## 권장 사항

### 실시간 드론 제어가 중요한 경우:
```bash
# 소프트웨어 H.264 사용 (자동 폴백)
export STREAM_CODEC=h264
python3 RGB_Camera_Stream.py
```
- 지연: ~100-200ms
- 하드웨어 인코더 실패 시 자동으로 소프트웨어 인코더 사용

### 안정성이 중요한 경우:
```bash
# MJPEG 사용
export STREAM_CODEC=mjpeg
python3 RGB_Camera_Stream.py
```
- 지연: ~150-300ms
- 가장 안정적 (인코더 문제 없음)

## 지연 시간 최적화

### 해상도 낮추기
```python
# 코드에서 수정
STREAM_WIDTH = 640   # 1280 → 640
STREAM_HEIGHT = 480  # 720 → 480
```
- 지연 감소: ~20-30%

### FPS 낮추기
```python
STREAM_FPS = 20  # 30 → 20
```
- 지연 감소: ~10-15%

### MJPEG quality 낮추기
- 현재: quality=75 (이미 최적화됨)
- 더 낮추면: quality=60 (지연 더 감소, 품질 약간 저하)

## 결론

**현재 상황에서 권장**:
1. **소프트웨어 H.264** (자동 폴백) - 지연 ~100-200ms
2. **MJPEG** (안정성 우선) - 지연 ~150-300ms

둘 다 실시간 드론 제어에 사용 가능한 수준입니다. 하드웨어 인코더 문제가 해결되면 ~50-100ms로 더 낮은 지연을 얻을 수 있습니다.
