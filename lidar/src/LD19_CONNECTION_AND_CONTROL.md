# LD19 연결 및 제어 가이드

## 연결 인터페이스

LD19는 **ZH1.5T-4P1.5mm 커넥터**를 통해 외부 시스템과 연결됩니다:
- **전원 공급**
- **데이터 수신**

## 모터 속도 제어

### 1. 내부 속도 제어 (기본 모드)

**설정 방법:**
- PWM 핀을 **GND에 연결**
- 전원 인가 시 자동으로 내부 속도 제어 모드로 동작

**특징:**
- 기본 속도: **10Hz**
- 추가 설정 불필요
- 가장 간단한 사용 방법

**현재 프로젝트 상태:**
- ✅ 내부 속도 제어 사용 중 (PWM 핀 GND 연결)
- ✅ 기본 10Hz 속도로 동작

### 2. 외부 속도 제어

**트리거 조건:**
1. **PWM 주파수**: 20-50KHz (권장: **30KHz**)
2. **듀티 사이클**: 45% ~ 55% 범위 (45%, 55% 제외)
3. **최소 연속 입력 시간**: **100ms**

**동작 방식:**
- 외부 속도 제어가 트리거되면 전원 차단 전까지 외부 제어 상태 유지
- 내부 제어로 자동 복귀하지 않음
- 듀티 사이클 조절로 속도 제어 가능

**정밀 제어:**
- 수신 데이터의 속도 정보를 기반으로 **폐루프 제어** 필요
- 제품별 모터 차이로 인해 동일 듀티 사이클에서도 속도 차이 발생 가능

**주의사항:**
- 외부 속도 제어를 사용하지 않을 때는 **PWM 핀을 반드시 GND에 연결**해야 함

## 데이터 통신

### UART 통신

**특징:**
- **단방향 통신** (LD19 → 외부 시스템)
- LD19가 데이터를 전송하고, 외부 시스템은 수신만 함

**통신 파라미터:**
- **Baudrate**: 230400 (현재 프로젝트 설정)
- **Data bits**: 8
- **Stop bits**: 1
- **Parity**: None
- **Flow control**: None

### 현재 프로젝트 설정

```cpp
// lidar_config.h
constexpr int DEFAULT_BAUDRATE = 230400;
```

**연결 방식:**
- **USB-UART**: `/dev/ttyUSB0` (개발/테스트용)
- **GPIO-UART (UART_E)**: `/dev/ttyS4` (배포용, VIM4)

## 프로젝트 적용

### 현재 구현 상태

1. **속도 제어**: ✅ 내부 속도 제어 (10Hz 기본)
2. **UART 통신**: ✅ 230400 baud 설정 완료
3. **데이터 수신**: ✅ 단방향 수신 구현 완료

### 향후 개선 가능 사항

1. **외부 속도 제어 추가** (필요 시):
   - PWM 신호 생성 (30KHz, 45-55% 듀티)
   - 속도 피드백 기반 폐루프 제어
   - 속도 조절 기능

2. **속도 모니터링**:
   - 수신 데이터에서 속도 정보 추출
   - 속도 표시/로깅

## 하드웨어 연결

### VIM4 GPIO-UART (UART_E) 연결

```
LD19          VIM4 40-pin Header
GND   ───→   Pin 6  (GND)
5V    ───→   Pin 2  (5V)
TX    ───→   Pin 15 (UART_E RX)
RX    ───→   Pin 16 (UART_E TX)
PWM   ───→   GND (내부 속도 제어)
```

### USB-UART 연결 (개발용)

```
LD19          USB-UART Adapter
GND   ───→   GND
5V    ───→   5V
TX    ───→   RX
RX    ───→   TX
PWM   ───→   GND (내부 속도 제어)
```

## 참고사항

1. **전원**: LD19는 5V 전원이 필요합니다
2. **PWM 핀**: 내부 속도 제어 사용 시 반드시 GND에 연결
3. **통신 방향**: LD19는 데이터를 전송만 하므로, 외부 시스템은 수신만 하면 됩니다
4. **속도**: 기본 10Hz는 대부분의 용도에 충분합니다

